# Websocket server port.
db-port = 8080

# This server hostname.
db-host = http://db.occase.de

# Value of the header field Access-Control-Allow-Origin
http-allow-origin = *

# The password used to allow admin to delete posts.
adm-password = kabuff

# The time after which the post is considered expired. On expiration
# the posts are not automatically removed but only when there is
# publication in the channel the post belongs to.
#
# When a publication in the channel takes place and some of its posts
# are removed, a delete command is issued to all databases and it is
# NOT removed from redis for safety.
#
# Input in seconds. (see the table in post-interval for useful values)
post-expiration = 7776000

# The size of the tcp backlog, see
# boost::asio::socket_base::max_listen_connections and
# tcp_max_syn_backlog on man tcp(7)
max-listen-connections = 1023

# Here you can configure the ssl/tls parameters
#
# 1. Server certificate.
# 2. Server private key.
# 3. Diffie-Hellman parameters. Can be generated with
#
#    openssl dhparam -out dhparam4096.pem 4096
#
# NOTE: When using ssl use port 443.
#ssl-certificate-file = /etc/letsencrypt/live/db.occase.de/fullchain.pem
#ssl-private-key-file = /etc/letsencrypt/live/db.occase.de/privkey.pem
#ssl-dh-file = /etc/occase/dhparam4096.pem

# Refer to the documentation in Beast for a better explanation
# https://www.boost.org/doc/libs/1_71_0/libs/beast/doc/html/beast/ref/boost__beast__websocket__stream_base__timeout.html
handshake-timeout = 10

# Refer to the documentation in Beast for a better explanation
# https://www.boost.org/doc/libs/1_71_0/libs/beast/doc/html/beast/ref/boost__beast__websocket__stream_base__timeout.html
# 
# The server will also set keep_alive_pings to true.
#
# NOTE: After accepting the webscoket connection the server will
# timeout it on the second pong received if it does not
# 
#    1. Send his credentials to be validated agains the database.
#    2. Or request a registration.
idle-timeout = 30

# We use the same log levels as syslog, they are
#
#  - emerg
#  - alert
#  - crit
#  - err
#  - warning
#  - notice
#  - info
#  - debug
log-level = debug

# Apps are allowed to publish n posts every k seconds. The value of k
# is equal for all users and has a default value passed below in
# post-interval.  The default value of n is passed below in
# allowed-posts and can be changed via adm api.
#
# When the deadline is reached the server will set the new deadline
# (by adding post-interval to the current time) and reset the allowed
# posts to whatever value is currently configured.
#
# - To prevent a user from posting set n to zero.
# - To allow a user to always post set n to a high enough value.
# - To allow one post per week set n to 1 and k to 60 * 60 * 24 * 7.
#
# Some useful values are
#
# - One hour     =               60 * 60 =    3600
# - One day      =          24 * 60 * 60 =   86400
# - One week     =      7 * 24 * 60 * 60 =  604800
# - One month    =     30 * 24 * 60 * 60 = 2592000
# - Three months = 3 * 30 * 24 * 60 * 60 = 7776000
#
post-interval = 2592000
allowed-posts = 4

# The maximum number of posts that occase-db can send to the client on
# a search. See endpoint /posts/search.
max-posts-on-search = 50

# The size of the automatically generated password.
password-size = 8

# The maximum duration of the adm http request in seconds.
http-session-timeout = 30

# The maximum duration of the ssl shutdown in seconds.
ssl-shutdown-timeout = 30

# The server name
server-name = occase-db

# User Id where messages should be sent to when users reply to the
# default chat that appears automatically after a user posts
# something.
chat-admin-id = e93e70c8f76429b209d946826fa6e480

# Multimedia server parameters
#-----------------------------------------------------------------------

# The key used to generate *authenticated* filenames to the image
# server. Should be kept as a secret shared between occase-db and
# occase-mms.
mms-key = jTGcIm0rBMSP1BJRJNju3085zwgnVs9w

# The mms host. This is used by the adm api to produce the html pages
# that make it possible to delete posts, say to control inapropriate
# content. It is also used to generate the mms file names.
mms-host = https://mms.occase.de

# Redis related configuration.
#-----------------------------------------------------------------------

# Redis host
redis-host = 127.0.0.1

# Redis port
redis-port = 6379

# The total number of chat messages sent so far. Useful for
# statistics.
redis-key-chat-msgs-counter = chat_messages_counter

# Every user has a list of chat messages that is composed by this
# value plus the user id
#
#   chat:id
#
redis-key-chat-msg-prefix = chat

# The key of the sorted set containing the posts.
redis-key-posts = posts

# Posts received on the api endpoint /posts/publish will be stored in
# redis and published in this channel to other occase-db instances.  A
# redis transaction is used to perform the operation.
redis-key-post-channel = posts_channel

# If an app does not connect for the duration of this time counting
# from its last login, then its chat messages will be removed from
# redis.
redis-user-msg-exp-time = 7776000

# The max number of offline messages allowed in the redis for each
# user.
redis-offline-chat-msgs = 500

# The redis channel where the occase-db will publish the tokens it
# receives from the users. At the moment fcm tokens. Must be the same
# as the one used in occase-notify.
redis-notify-channel = notify

# The name of the redis key used to store fcm tokens. Will be accessed
# by occase-notify on startup.
redis-tokens-key = fcm_tokens

# The redis key holding the number of visualizations for each post.
redis-post-visualizations-key = post_visualizations
